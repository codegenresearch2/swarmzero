import os\nimport pytest\nimport signal\nfrom unittest.mock import patch, MagicMock\nfrom llama_index.core.agent.runner.base import AgentRunner\nfrom llama_index.core.llms import ChatMessage, MessageRole\nfrom swarmzero.agent import Agent\nfrom swarmzero.tools.retriever.base_retrieve import IndexStore\n\n@pytest.fixture\ndef agent():\n    with patch('llama_index.core.VectorStoreIndex.from_documents'):\n        with patch('llama_index.core.objects.ObjectIndex.from_objects'):\n            with patch('swarmzero.agent.setup_routes'):\n                with patch('uvicorn.Server.serve', new_callable=MagicMock):\n                    os.environ['ANTHROPIC_API_KEY'] = 'anthropic_api_key'\n                    os.environ['MISTRAL_API_KEY'] = 'mistral_api_key'\n                    test_agent = Agent(\n                        name='TestAgent',\n                        functions=[lambda x: x],\n                        config_path='./swarmzero_config_test.toml',\n                        host='0.0.0.0',\n                        port=8000,\n                        instruction='Test instruction',\n                        role='leader',\n                        retrieve=True,\n                        required_exts=['.txt'],\n                        retrieval_tool='basic',\n                        load_index_file=False,\n                    )\n    return test_agent